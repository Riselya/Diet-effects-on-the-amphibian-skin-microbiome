---
title: "Rmarkdown: Dietary carotenoid supplementation has long-term and community-wide effects on the amphibian skin microbiome"
author: "Alice Risely"
date: "29/3/23"
output:
  html_document:
    toc: yes
    toc_depth: 3
    number_sections: true
    toc_float:
      collapsed: false
    theme: journal
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.height = 7, fig.width =10, time_it = TRUE, error = TRUE)
```

# Load packages

```{r packages}

library(phyloseq)
library(ggplot2)
library(vegan)
library(dplyr)
library(scales)
library(grid)
library(reshape2)
library(ape)
library(gridExtra)
library(ade4)
library(plyr)
library(tidyr)
library(data.table)
library(stringr)
library(ggrepel)
library(r2glmm)
library(ggvenn)
library(viridis)
library(ggord)


library(GGally)
library(sjPlot)
library(performance)

library(ggpubr)
library(microbiome)
library(RColorBrewer)
library(gllvm)
library(EnvStats)
library(ggcorrplot)

```

# Prevalence function
```{r include = F}

prevalence <- function(physeq, add_tax = TRUE){
  
  ## Check if taxa are rows
  trows <- taxa_are_rows(physeq)
  
  ## Extract OTU table
  otutab <- as.data.frame(otu_table(physeq))
  
  ## Transpose OTU table (species should be arranged by rows)
  if(trows == FALSE){
    otutab <- t(otutab)
  }
  
  ## Estimate prevalence (number of samples with OTU present)
  prevdf <- apply(X = otutab,
                  #MARGIN = ifelse(trows, yes = 1, no = 2),  # for a non-transposed data
                  MARGIN = 1,
                  FUN = function(x){sum(x > 0)})
  
  ## Add total and average read counts per OTU
  prevdf <- data.frame(Prevalence = prevdf,
                       TotalAbundance = taxa_sums(physeq),
                       MeanAbundance = rowMeans(otutab),
                       MedianAbundance = apply(otutab, 1, median))
  
  ## Add taxonomy table
  if(add_tax == TRUE && !is.null(tax_table(physeq, errorIfNULL = F))){
    prevdf <- cbind(prevdf, tax_table(physeq))
  }
  return(prevdf)
}
```

# Load data

```{r}
setwd("C:/Users/risel/Dropbox/Academic projects/Frog microbiome UOW/Frogs_UOW/Diet treatment project/Analysis in R")

frog_filtered <- readRDS("frog_final.RDS")
```

# Create transformed datasets

```{r}

frog_rare<-rarefy_even_depth(frog_filtered, sample.size = 6700)


```


# Bar plots

```{r}
frog_phylum<- tax_glom(frog_filtered, taxrank = "Phylum")
frog_phylum<- aggregate_top_taxa(frog_filtered, top = 10, level = "Phylum")
frog_phylum<- microbiome::transform(frog_phylum, "compositional")


### order

frog_order<- tax_glom(frog_filtered, taxrank = "Order")

frog_order<- microbiome::transform(frog_order, "compositional")
frog_order<-microbiome::core(frog_order, detection = 0, prevalence = 0.9)


##############################


ps1.com.fam <- microbiome::aggregate_top_taxa(frog_filtered, "Order", top = 22)

ps1.com.fam<- microbiome::transform(ps1.com.fam, "compositional")

plot.composition.relAbun <- microbiome::plot_composition(ps1.com.fam,
                                             sample.sort = "Treatment",
                                             x.label = "frog_id",
                                             group_by = "Treatment") 


data.com <- plot.composition.relAbun$data
colnames(data.com)


data.com$Tax<-ifelse(data.com$Tax == "Fimbriimonadales" | data.com$Tax == "Propionibacteriales" |data.com$Tax == "Verrucomicrobiales", "Other", as.character(data.com$Tax))


unique(data.com$Tax)
data.com$Tax<-factor(data.com$Tax, level = c("Flavobacteriales",
                                                     "Bacteroidales",
                                                     "Sphingobacteriales",
                                                     "Chitinophagales",
                                                     "Cytophagales",
                                                     
                                                     "Enterobacteriales",
                                                     "Pseudomonadales",
                                                     "Aeromonadales",
                                                     "Xanthomonadales",
                                                     "Betaproteobacteriales",
                                                     "Rhizobiales",
                                                     "Azospirillales",
                                                     "Sphingomonadales",
                                                     
                                                     "Corynebacteriales",
                                                     "Micrococcales",
                                                     
                                                     "Clostridiales",
                                                     "Bacillales",
                                                     "Lactobacillales",
                                                     
                                                     "Fusobacteriales",
                                                     "Other"))


colors <- c("lightskyblue","skyblue4", "royalblue","darkslategray4", "cyan",

            "#E7E1EF", "#D4B9DA", "#C994C7", "#DF65B0" ,"#E7298A" ,"#CE1256", "#980043", "#67001F",
            
            "forestgreen","olivedrab2",
            
            "yellow","chocolate","bisque",
            
            "navy",
            
            "white")

barplot_order<-ggplot(data.com, aes(x = Sample, y = Abundance, fill = Tax))+
  geom_bar(position = "stack", stat = "identity", width = 1, col = "black")+
  scale_x_discrete(labels = data.com$xlabel, breaks = data.com$Sample)+
  facet_grid(~Group, scales = "free") + theme_bw()+
  scale_fill_manual(values = colors)+
   theme_bw(base_size = 14)+
  theme(axis.text.x = element_blank())+
  labs(fill = "Bacterial order")+
  ylab("Relative abundance")+
    theme(legend.key.size = unit(0.4, 'cm'))+
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1)) 

#########################
#########################
#########################
#########################
#########################

plot.composition.relAbun <- microbiome::plot_composition(ps1.com.fam,
                                             sample.sort = "Sex",
                                             x.label = "frog_id",
                                             group_by = "Sex") 


data.com <- plot.composition.relAbun$data
colnames(data.com)


data.com$Tax<-ifelse(data.com$Tax == "Fimbriimonadales" | data.com$Tax == "Propionibacteriales" |data.com$Tax == "Verrucomicrobiales", "Other", as.character(data.com$Tax))


unique(data.com$Tax)
data.com$Tax<-factor(data.com$Tax, level = c("Flavobacteriales",
                                                     "Bacteroidales",
                                                     "Sphingobacteriales",
                                                     "Chitinophagales",
                                                     "Cytophagales",
                                                     
                                                     "Enterobacteriales",
                                                     "Pseudomonadales",
                                                     "Aeromonadales",
                                                     "Xanthomonadales",
                                                     "Betaproteobacteriales",
                                                     "Rhizobiales",
                                                     "Azospirillales",
                                                     "Sphingomonadales",
                                                     
                                                     "Corynebacteriales",
                                                     "Micrococcales",
                                                     
                                                     "Clostridiales",
                                                     "Bacillales",
                                                     "Lactobacillales",
                                                     
                                                     "Fusobacteriales",
                                                     "Other"))



# phylum level


ps1.com.phy <- microbiome::aggregate_top_taxa(frog_filtered, "Phylum", top = 4)

ps1.com.phy<- microbiome::transform(ps1.com.phy, "compositional")

plot.composition.relAbun <- microbiome::plot_composition(ps1.com.phy,
                                             sample.sort = "Treatment",
                                             x.label = "frog_id",
                                             group_by = "Treatment") 


data.com.phy <- plot.composition.relAbun$data


data.com.phy$Tax<-factor(data.com.phy$Tax, levels = c( "Bacteroidetes","Proteobacteria", "Actinobacteria", "Firmicutes", "Other"))


pal1<-c("lightskyblue", "plum3" , "#B2DF8A" , "#FFFF99", "white")


barplot_phylum<-ggplot(data.com.phy, aes(x = Sample, y = Abundance, fill = Tax))+
  geom_bar(position = "stack", stat = "identity", width = 1, col = "black")+
  scale_x_discrete(labels = data.com$xlabel, breaks = data.com$Sample)+
  facet_grid(~Group, scales = "free") + theme_bw()+
  scale_fill_manual(values = pal1)+
   theme_bw(base_size = 14)+
  theme(axis.text.x = element_blank())+
  theme(axis.title.x = element_blank())+
  labs(fill = "Bacterial phylum")+
  ylab("Relative abundance")+
    theme(legend.key.size = unit(0.4, 'cm'))+
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1)) 


ggarrange(barplot_phylum, barplot_order, ncol = 1, align = "v", heights = c(1,1.2) , labels = c("a)", "b)"))

#ggsave("fig2.pdf")

#Saving 13.6 x 7.68 in image

```


# Changes in relative abundance across treatment groups

```{r}


frog_genus<- microbiome::aggregate_top_taxa(frog_rare, "Genus", top = 20)

taxtable<-data.frame(tax_table(frog_genus))
taxa_names(frog_genus)<-taxtable$Genus
taxa_names(frog_genus)

#### table

UU_top<-subset_samples(frog_genus, Treatment == "UU") %>% transform("compositional")
UU_prev<-prevalence(UU_top)
UU_prev$Treatment<-"UU"


CU_top<-subset_samples(frog_genus, Treatment == "CU")%>% transform("compositional")
CU_prev<-prevalence(CU_top)
CU_prev$Treatment<-"CU"


UC_top<-subset_samples(frog_genus, Treatment == "UC") %>% transform("compositional")
UC_prev<-prevalence(UC_top)
UC_prev$Treatment<-"UC"


CC_top<-subset_samples(frog_genus, Treatment == "CC") %>% transform("compositional")
CC_prev<-prevalence(CC_top)
CC_prev$Treatment<-"CC"

prev_df<-rbind(UU_prev, UC_prev, CU_prev, CC_prev)
prev_df$Treatment <- factor(prev_df$Treatment, levels = c("UU", "CU", "UC", "CC"))

palx<-brewer.pal(12,"Paired")
paly<-brewer.pal(12,"Dark2")
pali<-brewer.pal(12,"Pastel1")

palz<-c(palx,paly, pali,palx,paly, pali)
scales::show_col(palz)
palz[12]<-"blue"
palz[14]<-"cyan3"
palz[15]<-"deeppink3"
palz[10]<-"darkviolet"
  
prev_df<-prev_df %>%  mutate(label = ifelse(Treatment == "CC", as.character(Genus), NA)) 
levels(prev_df$Treatment) <- c(levels(prev_df$Treatment),'') # add blank level

df<-subset(prev_df, Genus != "Other" & Genus !="Unknown" & Genus !="uncultured bacterium")
length(unique(df$Genus))



p1<-ggplot(subset(prev_df, Genus != "Other" & Genus !="Unknown" & Genus !="uncultured bacterium" & Genus !="Janthinobacterium" &  Genus !="Pedobacter" &  Genus !="Delftia"), aes(y = MeanAbundance, x = Treatment, group = Genus))+
  
  geom_line(aes(col = Genus), size = 1.5)+
  geom_point(aes(fill = Genus), size = 2, col = "black", pch = 21)+
  scale_color_manual(values = palz)+
  scale_fill_manual(values = palz)+
  scale_y_log10()+
  theme_bw(base_size = 14)+
  theme(legend.position = "none")+
  scale_x_discrete(drop=FALSE)+
  
  geom_label_repel(aes(label = label, fill = Genus),
                  alpha = 0.6,nudge_x = 1, fontface="bold",
                  na.rm = TRUE)+
  ylab("Mean relative abundance")




## ASV level ###
## ASV level ###
## ASV level ###
## ASV level ###


frog_asv<- core(frog_rare, detection = 0, prevalence = 0.94)


#### table

UU_top<-subset_samples(frog_asv, Treatment == "UU") %>% transform("compositional")
UU_prev<-prevalence(UU_top)
UU_prev$Treatment<-"UU"
UU_prev$ASV<-row.names(UU_prev)


CU_top<-subset_samples(frog_asv, Treatment == "CU")%>% transform("compositional")
CU_prev<-prevalence(CU_top)
CU_prev$Treatment<-"CU"
CU_prev$ASV<-row.names(CU_prev)



UC_top<-subset_samples(frog_asv, Treatment == "UC") %>% transform("compositional")
UC_prev<-prevalence(UC_top)
UC_prev$Treatment<-"UC"
UC_prev$ASV<-row.names(UC_prev)



CC_top<-subset_samples(frog_asv, Treatment == "CC") %>% transform("compositional")
CC_prev<-prevalence(CC_top)
CC_prev$Treatment<-"CC"
CC_prev$ASV<-row.names(CC_prev)



prev_df_asv<-rbind(UU_prev, UC_prev, CU_prev, CC_prev)
prev_df_asv$Treatment <- factor(prev_df_asv$Treatment, levels = c("UU", "CU", "UC", "CC"))

palx<-brewer.pal(12,"Paired")
paly<-brewer.pal(12,"Dark2")

palz<-c(palx,paly)
  
prev_df_asv<-prev_df_asv %>%  mutate(label = ifelse(Treatment == "CC", as.character(ASV), NA)) 
levels(prev_df_asv$Treatment) <- c(levels(prev_df_asv$Treatment),'') # add blank level

p2<-ggplot(prev_df_asv, aes(y = MeanAbundance, x = Treatment, group = ASV))+
  
  geom_line(aes(col = ASV), size = 1.5)+
  geom_point(aes(fill = ASV), size = 2, col = "black", pch = 21)+
  scale_color_manual(values = palz)+
  scale_fill_manual(values = palz)+
  scale_y_log10()+
  theme_bw(base_size = 14)+
  theme(legend.position = "none")+
  scale_x_discrete(drop=FALSE)+
  
  geom_label_repel(aes(label = label, fill = ASV),
                  alpha = 0.7,nudge_x = 1,
                  na.rm = TRUE)


ggarrange(p1, p2, ncol = 2)

```


# Alpha diversity

```{r}

alpha_df<-data.frame(estimate_richness(frog_rare))

alpha_df$Faiths_PD<-as.numeric(metagMisc::phyloseq_phylo_div(frog_rare, "PD")$PD)
row.names(alpha_df)<-sample_names(frog_filtered)

metadata<-data.frame(sample_data(frog_filtered))
metadata<-merge(metadata, alpha_df, by = 0)
summary(metadata$Observed)


metadata$Treatment <- factor(metadata$Treatment, levels = c("UU", "CU", "UC", "CC"))

# scale variables

metadata$Mass_scaled<-as.numeric(scale(metadata$Mass))
metadata$Seq_depth_transformed<-as.numeric(scale(sqrt(metadata$Seq_depth)))


```




### Model/distribution selection
```{r}

## choose best distributions for 3 measures of alpha diversity

#EnvStats::distChoose(metadata$Observed)$decision
#EnvStats::distChoose(metadata$InvSimpson)$decision
#EnvStats::distChoose(metadata$Shannon)$decision

#### observed 

observed_model<-glm(Observed~Treatment + Seq_depth_transformed+Sex+Mass_scaled, family= Gamma(link = "log"), data = metadata)

observed_model2<-glm(Observed~Treatment + Seq_depth_transformed+Sex+Mass_scaled, family= Gamma(link = "identity"), data = metadata) # technically correct?

observed_model3<-lm(Observed~Treatment + Seq_depth_transformed+Sex+Mass_scaled,  data = metadata) # best


AIC(observed_model, observed_model2, observed_model3)


######## invnormal ###
######## invnormal ###
######## invnormal ###

invsimp_model<-glm(InvSimpson~Treatment + Seq_depth_transformed+Sex, family= Gamma(link = "log"), data = metadata) # best


invsimp_model2<-glm(InvSimpson~Treatment + Seq_depth_transformed+Sex, family= Gamma(link = "identity"), data = metadata)


invsimp_model3<-lm(InvSimpson~Treatment + Seq_depth_transformed+Sex,  data = metadata)


AIC(invsimp_model, invsimp_model2, invsimp_model3)

##### shannon ########
##### shannon ########
##### shannon ########
##### shannon ########

shannon_model<-glm(Shannon~Treatment + Seq_depth_transformed+Sex+Mass_scaled, family= Gamma(link = "log"), data = metadata) # best


shannon_model2<-glm(Shannon~Treatment + Seq_depth_transformed+Sex+Mass_scaled, family= Gamma(link = "identity"), data = metadata)


shannon_model3<-lm(Shannon~Treatment + Seq_depth_transformed+Sex+Mass_scaled,  data = metadata) # best (sort of)

AIC(shannon_model, shannon_model2, shannon_model3)


```


### Fitting final models
```{r}


# final model

observed_model<-lm(Observed~Treatment +Sex +  Seq_depth_transformed, data = metadata)

summary(observed_model)


r2beta(observed_model, partial = TRUE, method = "sgv", data = metadata)


#### GET CONFIDENCE INTERVALS 
summary<-data.frame(confint(observed_model))
summaryest<-summary(observed_model) # add estimate as column
summaryest<-data.frame(summaryest$coefficients)

summary$Estimate<-summaryest$Estimate
summary<-summary[c(1:4),] #keep just first 4 rows

summary[2:4,]<-summary[2:4,]+summary[1,3] # add intercept to estimates for forest and organic
row.names(summary)<-c("UU", "CU", "UC", "CC")
names(summary)<-c("CI_lower", "CI_upper", "Est")
summary$Treatment<-row.names(summary)
summary$Treatment<-factor(summary$Treatment, levels = c(c("UU", "CU", "UC", "CC")))


# standard errors

summary_coef1<-summary(observed_model)
summary_coef1$coefficients
summary_coef1<- data.frame(summary_coef1$coefficients)
names(summary_coef1)

summary$SE_lower<-summary$Est-summary_coef1$Std..Error[1:4]
summary$SE_upper<-summary$Est+summary_coef1$Std..Error[1:4]

summary1<-summary

### ESIMATES AND CONFIDENCE INTERBALS ARE BACKTRANSFORMED IN PLOT USING EXP()

p1<-ggplot(summary1, aes( x =Treatment, y = Est))+
  geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper), width = 0, col = "grey", size = 1.5)+
  geom_errorbar(aes(ymin = SE_lower, ymax = SE_upper), width = 0,  size = 1.5)+
   geom_point( size = 4, pch = 21, fill = "black", col = "grey")+
  theme_light(base_size = 14)+
  ylab("Observed ASV richness")+
  theme(legend.position = "none")+
  xlab("")

############ inverse simpson  ##################
############ inverse simpson  ##################
############ inverse simpson  ##################
############ inverse simpson  ##################


# final model
invsimp_model<-glm(InvSimpson~Treatment +Sex+ Seq_depth_transformed, family= Gamma(link = "log"), data = metadata)


summary(invsimp_model)


r2beta(invsimp_model, partial = TRUE, method = "sgv", data = metadata)


#### GET CONFIDENCE INTERVALS FROM GAMMA

summary2<-data.frame(confint(invsimp_model))
summary2est<-summary(invsimp_model) # add estimate as column
summary2est<-data.frame(summary2est$coefficients)

summary2$Estimate<-summary2est$Estimate
summary2<-summary2[c(1:4),] #keep just first 4 rows

summary2[2:4,]<-summary2[2:4,]+summary2[1,3] # add intercept to estimates for forest and organic
row.names(summary2)<-c("UU", "CU", "UC", "CC")
names(summary2)<-c("CI_lower", "CI_upper", "Est")
summary2$Treatment<-row.names(summary2)
summary2$Treatment<-factor(summary2$Treatment, levels = c(c("UU", "CU", "UC", "CC")))


# standard errors

summary2_coef1<-summary(invsimp_model)
summary2_coef1$coefficients
summary2_coef1<- data.frame(summary2_coef1$coefficients)
names(summary2_coef1)

summary2$SE_lower<-summary2$Est-summary2_coef1$Std..Error[1:4]
summary2$SE_upper<-summary2$Est+summary2_coef1$Std..Error[1:4]

### ESIMATES AND CONFIDENCE INTERBALS ARE BACKTRANSFORMED IN PLOT USING EXP()

p2<-ggplot(summary2, aes( x =Treatment, y = exp(Est)))+
  geom_errorbar(aes(ymin = exp(CI_lower), ymax = exp(CI_upper)), width = 0, col = "grey", size = 1.5)+
  geom_errorbar(aes(ymin = exp(SE_lower), ymax = exp(SE_upper)), width = 0,  size = 1.5)+
   geom_point( size = 4, pch = 21, fill = "black", col = "grey")+
  theme_light(base_size = 14)+
  ylab("Inverse Simpson Index")+
  theme(legend.position = "none")


################ shannon ##################
################ shannon ##################
################ shannon ##################
################ shannon ##################

# final model

shannon_model<-lm(Shannon~Treatment +Sex+ Seq_depth_transformed,  data = metadata)
summary(shannon_model)


r2beta(shannon_model, partial = TRUE, method = "sgv", data = metadata)


#### GET CONFIDENCE INTERVALS FROM GAMMA

summary3<-data.frame(confint(shannon_model))
summary3est<-summary(shannon_model) # add estimate as column
summary3est<-data.frame(summary3est$coefficients)

summary3$Estimate<-summary3est$Estimate
summary3<-summary3[c(1:4),] #keep just first 4 rows

summary3[2:4,]<-summary3[2:4,]+summary3[1,3] # add intercept to estimates for forest and organic
row.names(summary3)<-c("UU", "CU", "UC", "CC")
names(summary3)<-c("CI_lower", "CI_upper", "Est")
summary3$Treatment<-row.names(summary3)
summary3$Treatment<-factor(summary3$Treatment, levels = c(c("UU", "CU", "UC", "CC")))


# standard errors

summary3_coef1<-summary(shannon_model)
summary3_coef1$coefficients
summary3_coef1<- data.frame(summary3_coef1$coefficients)
names(summary3_coef1)

summary3$SE_lower<-summary3$Est-summary3_coef1$Std..Error[1:4]
summary3$SE_upper<-summary3$Est+summary3_coef1$Std..Error[1:4]

### ESIMATES AND CONFIDENCE INTERBALS ARE BACKTRANSFORMED IN PLOT USING EXP()

p3<-ggplot(summary3, aes( x =Treatment, y = Est))+
  geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper), width = 0, col = "grey", size = 1.5)+
  geom_errorbar(aes(ymin = SE_lower, ymax = SE_upper), width = 0,  size = 1.5)+
   geom_point( size = 4, pch = 21, fill = "black", col = "grey")+
  theme_light(base_size = 14)+
  ylab("Shannon Index")+
  theme(legend.position = "none")+
  xlab("")



ggpubr::ggarrange(p1, p2, p3, ncol = 3, labels = c("a)", "b)", "c)"))

tab_model(observed_model, invsimp_model, shannon_model,  pred.labels = c("Intercept [UU]", "Treatment [CU]", "Treatment [UC]", "Treatment [CC]",  "Sex [Male]", "Sequencing depth"), dv.labels = c("a) Observed ASV richness", "b) Inverse Simpson", "c) Shannon"))

#ggsave("Figures/Fig3.pdf")


```

# Beta diversity - constrained ordination

## Weighted Unifrac

```{r}

#############


wunifrac_dist<-distance(frog_rare, method = "wunifrac")
otutable<-data.frame(t(frog_rare@otu_table@.Data))
metadata <- data.frame(sample_data(frog_rare))


Treatment <- metadata$Treatment
Seq_depth <- as.numeric(scale(metadata$Seq_depth))
Mass <-metadata$Mass
Sex<-as.factor(metadata$Sex)
Date<-as.factor(metadata$date_cat)

metadata<- metadata %>% mutate(MassCat = case_when((Mass <2.45 ~ "Light"),
                                          (Mass > 3 ~ "Heavy")))

metadata$MassCat <-ifelse(is.na(metadata$MassCat), "Average", metadata$MassCat)
                                            
MassCat <-as.factor(metadata$MassCat)


final_model<-capscale(wunifrac_dist ~ 
                   Treatment+
                   Seq_depth+
                     Sex,
                env = metadata, 
                comm = otutable) 


# Note: including mass reduces effect of treatment - mechanism?

# weighted unifrac

anova_wunifrac<-anova.cca(final_model, by="terms")
anova_wunifrac

####### plot #####
####### plot #####
####### plot #####


## extract data from model

final_model_df<-scores(final_model)

# extract CAP scores

vectors_df<-data.frame(final_model_df$sites)
vectors_df$feature.id<-row.names(vectors_df)


# merge with info on dominant family

sample_metadata<-data.frame(sample_data(frog_rare))[,c("feature.id", "Treatment")]
vectors_df<-merge(vectors_df, sample_metadata, by = "feature.id")


#### add arrows #########
#### add arrows #########
#### add arrows #########
#### add arrows #########

centroids_df<-data.frame(final_model_df$centroids)
centroids_df<-centroids_df[1:6,]
centroids_df
row.names(centroids_df)<-c("Treatment: UU", "Treatment: CU","Treatment: UC","Treatment: CC", "Sex:F", "SexM" )



### add taxa scores ########
### add taxa scores ########
### add taxa scores ########
### add taxa scores ########



species_scores<-data.frame(final_model_df$species)

summary(species_scores$CAP1)
summary(species_scores$CAP2)


species_scores<-subset(species_scores,  (CAP2 > 0.2 | CAP2 < -0.2) |  (CAP1 > 0.2 | CAP1 < -0.2))

species_scores$CAP1<-species_scores$CAP1 *4
species_scores$CAP2<-species_scores$CAP2 *4

###########
###########
###########
###########

vectors_wunifrac<-vectors_df
centroids_wunifrac<-centroids_df
species_wunifrac<-species_scores

# colour palette
pal<-pals::stepped3()[c(1,5,9,13)]
pal<-pals::tol()[c(1,3,4,12)]


plot_wunifrac<-ggplot(vectors_wunifrac, aes(x = CAP1, y = CAP2))+
 
   stat_ellipse(geom = "polygon", aes(fill = Treatment, col = Treatment), level = 0.9, alpha = 0.3, size = 0.5)+
  geom_point(aes(fill =Treatment), pch = 21, size = 3, alpha = 1, stroke = 1, col = "black")+
  
  theme_bw()+
 scale_fill_viridis(discrete = TRUE)+
 scale_color_viridis(discrete = TRUE)+
  
  # add arrows
  
  geom_segment(data=centroids_wunifrac[1:4,], aes(x = 0, y = 0, xend = CAP1*2, yend = CAP2*2),
    arrow = arrow(length = unit(0.5, "cm"), type = "closed"), lwd = 1,  col = "black")+
  ggrepel::geom_label_repel(data=centroids_wunifrac[1:4,],  
    alpha = 0.9, col = "black", size = 4, fill = "yellow", 
    aes(CAP1*2, CAP2*2, label = row.names(centroids_wunifrac[1:4,])))+

  theme_light(base_size = 14)+
  ggtitle("a) Treatment: WU")



```

## Bray Curtis
```{r}

#############

bray_dist<-distance(frog_rare, method = "bray")
otutable<-data.frame(t(frog_rare@otu_table@.Data))
metadata <- data.frame(sample_data(frog_rare))


Treatment <- metadata$Treatment
Seq_depth <- as.numeric(scale(metadata$Seq_depth))
Mass <-metadata$Mass
Sex<-as.factor(metadata$Sex)
Date<-as.factor(metadata$date_cat)

metadata<- metadata %>% mutate(MassCat = case_when((Mass <2.45 ~ "Light"),
                                          (Mass > 3 ~ "Heavy")))

metadata$MassCat <-ifelse(is.na(metadata$MassCat), "Average", metadata$MassCat)
                                            
MassCat <-as.factor(metadata$MassCat)



final_model<-capscale(bray_dist ~ 
                   Treatment+
                    Seq_depth+
                     Sex,

                env = metadata, 
                comm = otutable) 



# Note: including mass reduces effect of treatment - mechanism?

# weighted bray

anova_bray<-anova.cca(final_model, by="terms")
round(data.frame(anova_bray), 3)
round(data.frame(anova_wunifrac), 3)


####### plot #####
####### plot #####
####### plot #####


## extract data from model

final_model_df<-scores(final_model)


# extract CAP scores

vectors_df<-data.frame(final_model_df$sites)
vectors_df$feature.id<-row.names(vectors_df)


# merge with info on dominant family

sample_metadata<-data.frame(sample_data(frog_rare))[,c("feature.id", "Treatment")]
vectors_df<-merge(vectors_df, sample_metadata, by = "feature.id")



#### add arrows #########
#### add arrows #########
#### add arrows #########
#### add arrows #########

centroids_df<-data.frame(final_model_df$centroids)
centroids_df<-centroids_df[1:6,]
row.names(centroids_df)<-c("Treatment: UU", "Treatment: CU","Treatment: UC","Treatment: CC", "SexF", "SexM" )



### add taxa scores ########
### add taxa scores ########


species_scores<-data.frame(final_model_df$species)

summary(species_scores$CAP1)
summary(species_scores$CAP2)


species_scores<-subset(species_scores,  (CAP2 > 0.2 | CAP2 < -0.2) |  (CAP1 > 0.2 | CAP1 < -0.2))

species_scores$CAP1<-species_scores$CAP1 *3
species_scores$CAP2<-species_scores$CAP2 *3

###########################
###########################
###########################
###########################

plot_bray<-ggplot(vectors_df, aes(x = CAP1, y = CAP2))+
 
    stat_ellipse(geom = "polygon", aes(fill = Treatment, col = Treatment), level = 0.9, alpha = 0.3, size = 0.5)+
  geom_point(aes(fill =Treatment), pch = 21, size = 3, alpha = 1, stroke = 1, col = "black")+
  

 scale_fill_viridis(discrete = TRUE)+
 scale_color_viridis(discrete = TRUE)+
  
  # add arrows
  
  geom_segment(data=centroids_df[1:4,], aes(x = 0, y = 0, xend = CAP1*2, yend = CAP2*2),
    arrow = arrow(length = unit(0.5, "cm"), type = "closed"), lwd = 1,  col = "black")+
  ggrepel::geom_label_repel(data=centroids_df[1:4,],  
    alpha = 0.9, col = "black", size = 4, fill = "yellow", 
    aes(CAP1*2, CAP2*2, label = row.names(centroids_df[1:4,])))+
  theme_light(base_size = 14)+
  ggtitle("b) Treatment: BC")


### plot together

treatment_plots<-ggarrange(plot_wunifrac, plot_bray,  common.legend = T, legend = "right")

```

## Beta diversity by sex
```{r}

sex_wunifrac<-ggplot(vectors_wunifrac, aes(x = CAP1, y = CAP2))+
 
   stat_ellipse(geom = "polygon", aes(fill = Sex, col = Sex), level = 0.9, alpha = 0.3, size = 0.5)+
  geom_point(aes(fill =Sex), pch = 21, size = 3, alpha = 1, stroke = 1, col = "black")+
  
  theme_bw()+
 scale_fill_manual(values = c("skyblue", "darkred"))+
 scale_color_manual(values = c("skyblue", "darkred"))+
  
  # add arrows
  
  geom_segment(data=centroids_wunifrac[5:6,], aes(x = 0, y = 0, xend = CAP1*2, yend = CAP2*2),
    arrow = arrow(length = unit(0.5, "cm"), type = "closed"), lwd = 1,  col = "black")+
  ggrepel::geom_label_repel(data=centroids_wunifrac[5:6,],  
    alpha = 0.9, col = "black", size = 4, fill = "yellow", 
    #hjust = c(0,1), 
    #vjust = c(1,1),
    aes(CAP1*2, CAP2*2, label = row.names(centroids_wunifrac[5:6,])))+
  theme_light(base_size = 14)+
  ggtitle("c) Sex: WU")+
  theme(plot.margin = margin(0.2,0.8,0.2,0.2, "cm")) 

#################
#################
#################
#################


sex_bray<- ggplot(vectors_df, aes(x = CAP1, y = CAP2))+
 
    stat_ellipse(geom = "polygon", aes(fill = Sex, col = Sex), level = 0.9, alpha = 0.3, size = 0.5)+
  geom_point(aes(fill =Sex), pch = 21, size = 3, alpha = 1, stroke = 1, col = "black")+
  

 scale_fill_manual(values = c("skyblue", "darkred"))+
 scale_color_manual(values = c("skyblue", "darkred"))+

  # add arrows
  
  geom_segment(data=centroids_df[5:6,], aes(x = 0, y = 0, xend = CAP1*2, yend = CAP2*2),
    arrow = arrow(length = unit(0.5, "cm"), type = "closed"), lwd = 1,  col = "black")+
  ggrepel::geom_label_repel(data=centroids_df[5:6,],  
    alpha = 0.9, col = "black", size = 4, fill = "yellow", 

    aes(CAP1*2, CAP2*2, label = row.names(centroids_df[5:6,])))+


  theme_light(base_size = 14)+
  ggtitle("d) Sex: BC")+
  theme(plot.margin = margin(0.2,1.3,0.2,0, "cm")) 

sex_plots<-ggarrange(sex_wunifrac, sex_bray,  common.legend = T, legend = "right") 


ggarrange(treatment_plots, sex_plots,  common.legend = T, legend = "right", nrow = 2, align = "v")

#ggsave("Figures/Fig4.pdf")

```


# Joint-species distribution modelling
## JSDM: Genus level


```{r}
# https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13303

# final model 

frog_genus<-tax_glom(frog_filtered, taxrank = "Genus")

frog_genus_core<-core(frog_genus, detection = 20, prevalence = 0.70)
#frog_genus_core<-microbiome::aggregate_top_taxa(frog_filtered, "Genus", top = 45)

frog_genus
frog_genus_core
sum(sample_sums(frog_genus_core))/sum(sample_sums(frog_genus))


taxtable<-data.frame(tax_table(frog_genus_core))

frog_genus_core<-subset_taxa( frog_genus_core, Genus != "uncultured" )
frog_genus_core<-subset_taxa( frog_genus_core, Genus != "metagenome" )
frog_genus_core<-subset_taxa( frog_genus_core, Genus != "uncultured bacterium" )
frog_genus_core<-subset_taxa( frog_genus_core, Genus != "Other" )
frog_genus_core<-subset_taxa( frog_genus_core, Genus != "Unknown" )
frog_genus_core<-subset_taxa( frog_genus_core, Genus != "Allorhizobium-Neorhizobium-Pararhizobium-Rhizobium" )
frog_genus_core<-subset_taxa( frog_genus_core, Genus != "CL500-29 marine group" )

taxa_keep<- taxa_names(frog_genus_core)

sum(sample_sums(frog_genus_core))/sum(sample_sums(frog_genus))

taxtable<-data.frame(tax_table(frog_genus_core))

taxa_names(frog_genus_core)<- taxtable$Genus


## Extract relevant data for model

y <- data.frame(t(otu_table(frog_genus_core)))
X<-data.frame(sample_data(frog_genus_core))


X$Mass_scaled<-as.numeric(scale(X$Mass))
X$Seq_depth_scaled<-as.numeric(scale(sqrt(X$Seq_depth)))

X<-X[,c("Treatment", "Mass_scaled", "Seq_depth_scaled", "Sex")]


```

### Model comparison
```{r}


fit_1LV <- gllvm(y, X, 
             num.lv = 1,
            formula = ~ Treatment+ Sex  + Seq_depth_scaled, 
             family = "negative.binomial")

fit_2LV <- gllvm(y, X, 
             num.lv = 2,
            formula = ~ Treatment+ Sex + Seq_depth_scaled, 
             family = "negative.binomial")


fit_3LV <- gllvm(y, X, 
             num.lv = 3,
            formula = ~ Treatment+ Sex  + Seq_depth_scaled, 
             family = "negative.binomial")



# compare AIC

AIC( fit_1LV, fit_2LV, fit_3LV)



```

### Final model
```{r}

fit <- gllvm(y, X, 
             num.lv = 3,
            formula = ~ Treatment+ Sex + Seq_depth_scaled, 
             family = "negative.binomial")

coefplot(fit, cex.ylab = 0.7, which.Xcoef = c(1:4))

dev.off()

cr1<-getResidualCor(fit)

cr2<-cor_pmat(cr1)

ggcorrplot(cr1, hc.order = TRUE,
   outline.col = "white",
   type = "full",
   ggtheme = ggplot2::theme_minimal,
   tl.cex = 7.5,
   p.mat = cr2,
   sig.level = 0.01,
  # show.diag = F,
   insig = "blank",
  # colors = c("#6D9EC1", "white", "#E46726"))
   colors = c("blue", "white", "red"))


corrplot::corrplot(cr1, type = "lower", order = "hclust", tl.cex = 0.7)


```

### Extract estimates 
```{r}


df<-coef(fit)

est_df<-data.frame(df$Intercept)

est_df2<-data.frame(df$Xcoef) # choose columns of interest

est_df3<-merge(est_df, est_df2, by = 0)

head(est_df3)



# order genera

row.names(est_df3)<-est_df3$Row.names
est_df3<-est_df3[colnames(y),]

#put est_df3 into long format

names(est_df3)[1]<- "Genus"
names(est_df3)[2]<- "Intercept"

estimates_df <- gather(est_df3, Treatment, Estimate, names(est_df3)[2]:names(est_df3)[ncol(est_df3)], factor_key=TRUE)

############# extract confindence intervals  ####
############# extract confindence intervals  ####
############# extract confindence intervals  ####
############# extract confindence intervals  ####


confint_df<-data.frame(confint(fit))


confint_df<-rbind(confint_df[rownames(confint_df) %like% "Xcoef", ],
confint_df[rownames(confint_df) %like% "Intercept", ])

head(confint_df)

# add a column with correct variable level
variables<- colnames(est_df3)[3:ncol(est_df3)]
variables<-c(variables, "Intercept")
variables1<-rep(variables, nrow(est_df))
variables2<-variables1[order(match(variables1, variables))]

#confint_df$Treatment<-c(rep("UU", 40), rep("CU", 40), rep("UC", 40), rep("CC", 40))
confint_df$Treatment<-variables2


# column with taxa names. Should be automatically in the correct order but double check

confint_df$Genus<-rep(colnames(y), length(unique(confint_df$Treatment)))



# now have estimates, confidence intervals, aas seperate data frames, but they are in different formats. Need to massage them into one dataframe for plotting.

merged<-merge(estimates_df, confint_df, by = c("Treatment", "Genus"))


final_estimates_reduced<- merged
names(final_estimates_reduced)[4]<-"CI_lower"
names(final_estimates_reduced)[5]<-"CI_upper"

#final_estimates<- merged[,c(1,2,3,7,8)]
head(final_estimates_reduced)
unique(final_estimates_reduced$Treatment)

final_estimates_reduced2<-subset(final_estimates_reduced, Treatment != "SexM" & Treatment != "Seq_depth_scaled")

## add significance

final_estimates_reduced2$Sig<- !data.table::between(0, final_estimates_reduced2$CI_lower, final_estimates_reduced2$CI_upper)


final_estimates_reduced2$Genus<-factor(final_estimates_reduced2$Genus)

levels(final_estimates_reduced2$Treatment)

final_estimates_reduced2$Treatment<-factor(final_estimates_reduced2$Treatment)
levels(final_estimates_reduced2$Treatment)<-c("UU", "CU", "UC", "CC")



ggplot(subset(final_estimates_reduced2, Treatment != "UU"), aes(y = reorder(Genus, Estimate), x = Estimate, col = Sig))+
  geom_point()+
  facet_wrap(~Treatment, nrow = 1, scales = "free_x")  + 
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper, col = Sig), height = 0, size = 0.5)+
  geom_vline(xintercept = 0, linetype = "longdash")+
  theme_bw()+
  scale_color_manual(values = c("grey", "red"))+
  theme(axis.title.y = element_blank())+
  theme(axis.text.y = element_text(face="bold", size = 8))+
  theme(legend.position = "none")+
 theme(plot.margin=unit(c(0.2,0.2, 0.2, 0.6),"cm"))

ggplot(subset(final_estimates_reduced2, Treatment != "UU"), aes(y = Estimate, x = Treatment, col = Sig))+
  geom_point()+
  facet_wrap(~Genus)  + 
  geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper, col = Sig), width = 0, size = 0.5)+
  geom_hline(yintercept = 0, linetype = "longdash")+
  theme_bw()+
  scale_color_manual(values = c("grey", "red"))+
  theme(axis.title.y = element_blank())+
  theme(axis.text.y = element_text(face="bold", size = 8))+
  theme(legend.position = "none")+
 theme(plot.margin=unit(c(0.2,0.2, 0.2, 0.6),"cm"))


  
## plot only significant

estimates_sig<- subset(final_estimates_reduced2,  Genus == "Comamonas" |  Genus == "Empedobacter" |  Genus == "Enterobacter" |  Genus == "Enterococcus" |   Genus == "Flavobacterium" |   Genus == "Kluyvera" |  Genus == "Lactococcus" | Genus == "Methylobacterium" | Genus == "Paenarthrobacter" |  Genus == "Pragia" |Genus == "Sphingobacterium" |  Genus == "Thermomonas")

estimates_sig<-estimates_sig%>%arrange(Treatment, Genus)


estimates_sig$Genus<-factor(estimates_sig$Genus)


estimates_sig$Effect_type <- rep(c("Additive", 
                                   "Additive",
                                   "Additive", 
                                   "Dominant", 
                                   "Additive", 
                                   "Adult/Dominant",
                                   "Developmental/Dominant", 
                                   "Developmental/Dominant", 
                                   "Adult/Dominant", 
                                   "Dominant",
                                   "Other",
                                   "Adult/Dominant"), 4)

estimates_sig$Effect_type <-factor(estimates_sig$Effect_type , levels = c("Additive", "Dominant", "Adult/Dominant", "Developmental/Dominant", "Other"))

ggplot(subset(estimates_sig, Treatment != "UU"), aes(y = Estimate, x = Treatment, col = Sig))+
  geom_point()+
  facet_wrap(~Effect_type+Genus, scales = "free_y")  + 
  geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper, col = Sig), width = 0, size = 0.5)+
  geom_hline(yintercept = 0, linetype = "longdash")+
  theme_bw()+
  scale_color_manual(values = c("grey", "red"))+
  theme(axis.title.y = element_blank())+
  theme(axis.text.y = element_text(face="bold", size = 8))+
  theme(legend.position = "none")+
 theme(plot.margin=unit(c(0.2,0.2, 0.2, 0.6),"cm"))





```

## JSDM: ASV level
```{r}
##### ASV level ##########
##### ASV level ##########

frog_core<-core(frog_filtered, detection = 30, prevalence = 0.70)
taxanames<-taxa_names(frog_core)

sum(taxa_sums(frog_core))/sum(taxa_sums(frog_filtered))


y <- data.frame(t(otu_table(frog_core)))
X<-data.frame(sample_data(frog_core))


X$Mass_scaled<-as.numeric(scale(X$Mass))
X$Seq_depth_scaled<-as.numeric(scale(sqrt(X$Seq_depth)))

X<-X[,c("Treatment","Sex", "Mass_scaled", "Seq_depth_scaled")]

X$Treatment<-factor(X$Treatment, levels = c("UU", "CU", "UC", "CC"))

```

### Model comparison
```{r}

fit <- gllvm(y, X, 
             num.lv = 2,
            formula = ~ Treatment+  Sex +Seq_depth_scaled, 
             family = "negative.binomial")

#############

fit1 <- gllvm(y, X, 
             num.lv = 2,
            formula = ~ Treatment+ Mass_scaled  +Seq_depth_scaled, 
             family = "negative.binomial")

###################

fit2 <- gllvm(y, X, 
             num.lv = 3,
            formula = ~ Treatment+  Sex +Seq_depth_scaled, 
             family = "negative.binomial")

#############

fit3 <- gllvm(y, X, 
             num.lv = 3,
            formula = ~ Treatment+ Mass_scaled  +Seq_depth_scaled, 
             family = "negative.binomial")

###################


AIC(fit, fit1, fit2, fit3)

```

### Final model
```{r}


fit <- gllvm(y, X, 
             num.lv = 3,
            formula = ~ Treatment+ Sex  +Seq_depth_scaled, 
             family = "negative.binomial")
dev.off()

coefplot(fit, cex.ylab = 0.7, which.Xcoef = c(1:4))

dev.off()

```

```{r}
### extract estimates and CIs ###
### extract estimates and CIs ###
### extract estimates and CIs ###
### extract estimates and CIs ###


df<-coef(fit)

est_df<-data.frame(df$Intercept)

est_df2<-data.frame(df$Xcoef) # choose columns of interest

est_df3<-merge(est_df, est_df2, by = 0)

head(est_df3)



# order genera

row.names(est_df3)<-est_df3$Row.names
est_df3<-est_df3[colnames(y),]

#put est_df3 into long format

names(est_df3)[1]<- "Genus"
names(est_df3)[2]<- "Intercept"

estimates_df <- gather(est_df3, Treatment, Estimate, names(est_df3)[2]:names(est_df3)[ncol(est_df3)], factor_key=TRUE)

############# extract confindence intervals  ####
############# extract confindence intervals  ####
############# extract confindence intervals  ####
############# extract confindence intervals  ####


confint_df<-data.frame(confint(fit))


confint_df<-rbind(confint_df[rownames(confint_df) %like% "Xcoef", ],
confint_df[rownames(confint_df) %like% "Intercept", ])

head(confint_df)

# add a column with correct variable level
variables<- colnames(est_df3)[3:ncol(est_df3)]
variables<-c(variables, "Intercept")
variables1<-rep(variables, nrow(est_df))
variables2<-variables1[order(match(variables1, variables))]

#confint_df$Treatment<-c(rep("UU", 40), rep("CU", 40), rep("UC", 40), rep("CC", 40))
confint_df$Treatment<-variables2


# column with taxa names. Should be automatically in the correct order but double check

confint_df$Genus<-rep(colnames(y), length(unique(confint_df$Treatment)))



# now have estimates, confidence intervals, aas seperate data frames, but they are in different formats. Need to massage them into one dataframe for plotting.

merged<-merge(estimates_df, confint_df, by = c("Treatment", "Genus"))


final_estimates_reduced<- merged
names(final_estimates_reduced)[4]<-"CI_lower"
names(final_estimates_reduced)[5]<-"CI_upper"

#final_estimates<- merged[,c(1,2,3,7,8)]
head(final_estimates_reduced)
unique(final_estimates_reduced$Treatment)

final_estimates_reduced2<-subset(final_estimates_reduced, Treatment != "SexM" & Treatment != "Seq_depth_scaled")

## add significance

final_estimates_reduced2$Sig<- !data.table::between(0, final_estimates_reduced2$CI_lower, final_estimates_reduced2$CI_upper)


final_estimates_reduced2$Genus<-factor(final_estimates_reduced2$Genus)

levels(final_estimates_reduced2$Treatment)

final_estimates_reduced2$Treatment<-factor(final_estimates_reduced2$Treatment)
levels(final_estimates_reduced2$Treatment)<-c("UU", "CU", "UC", "CC")



ggplot(subset(final_estimates_reduced2, Treatment != "UU"), aes(y = reorder(Genus, Estimate), x = Estimate, col = Sig))+
  geom_point()+
  facet_wrap(~Treatment, nrow = 1, scales = "free_x")  + 
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper, col = Sig), height = 0, size = 0.5)+
  geom_vline(xintercept = 0, linetype = "longdash")+
  theme_bw()+
  scale_color_manual(values = c("grey", "red"))+
  theme(axis.title.y = element_blank())+
  theme(axis.text.y = element_text(face="bold", size = 8))+
  theme(legend.position = "none")+
 theme(plot.margin=unit(c(0.2,0.2, 0.2, 0.6),"cm"))

ggplot(subset(final_estimates_reduced2, Treatment != "UU"), aes(y = Estimate, x = Treatment, col = Sig))+
  geom_point()+
  facet_wrap(~Genus)  + 
  geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper, col = Sig), width = 0, size = 0.5)+
  geom_hline(yintercept = 0, linetype = "longdash")+
  theme_bw()+
  scale_color_manual(values = c("grey", "red"))+
  theme(axis.title.y = element_blank())+
  theme(axis.text.y = element_text(face="bold", size = 8))+
  theme(legend.position = "none")+
 theme(plot.margin=unit(c(0.2,0.2, 0.2, 0.6),"cm"))


# only significant ASVs

sig_asvs<-unique((subset(final_estimates_reduced2, Sig == "Significant"))$ASV)
final_estimates_reduced2$Keep<-final_estimates_reduced2$Genus %in% sig_asvs

estimates_sig<-subset(treatment_ci_df, Keep == TRUE)

ggplot(subset(estimates_sig, Treatment != "UU" ), aes(y = Estimate, x = Treatment, col = Sig))+
  geom_point()+
  facet_wrap(~Genus)  + 
  geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper, col = Sig), width = 0, size = 0.5)+
  geom_hline(yintercept = 0, linetype = "longdash")+
  theme_bw()+
  scale_color_manual(values = c("grey", "red"))+
  theme(axis.title.y = element_blank())+
  theme(axis.text.y = element_text(face="bold", size = 8))+
  theme(legend.position = "none")+
 theme(plot.margin=unit(c(0.2,0.2, 0.2, 0.6),"cm"))


```


